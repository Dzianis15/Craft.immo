<!doctype html>
<html lang="fr">
<head>…(как было)…</head>
<body>
  <div class="wrap">
    <header>…(как было)…</header>

    <!-- Переключатель языков СЮДА -->
    <div class="card" id="langBar" style="display:flex;gap:8px;align-items:center;justify-content:flex-end">
      <button class="btn" id="langFR" type="button" style="padding:8px 12px">FR</button>
      <button class="btn" id="langEN" type="button" style="padding:8px 12px;opacity:.7;background:#111">EN</button>
    </div>
    
<script>
/* ==== I18N: FR / EN ==== */
…весь твой i18n код…
</script>

<script>
/* твой основной код: TYPES, LOTS, renderLots и т.д. */

const LANG = {
  fr: {
    headerTitle: "Le Grand Clos — Votre sélection de lot",
    headerHint: "Maisons T4 (84 m²), T5 Classique (106 m²), T5 Contemporain (104 m²) — Le Quiou (22630)",

    step0Title: "Souhaitez-vous obtenir des informations sur un lot disponible ?",
    intentYes: "Oui, je cherche un lot",
    intentNo: "Non, juste découvrir le projet",

    step1Title: "Quel type de maison vous intéresse ?",
    typeT4: "T4 — 84 m²",
    typeT5c: "T5 Classique — 106 m²",
    typeT5cont: "T5 Contemporain — 104 m²",

    step2Title: "Souhaitez-vous choisir un lot précis ?",
    hasLotYes: "Oui, choisir un lot",
    hasLotNo: "Peu importe, proposez-moi",

    step3Title: "Sélectionnez votre lot",
    reserved: "Réservé",

    step4Title: "Souhaitez-vous la version Classique ou Premium ?",
    packClassique: "Classique",
    packPremium: "Premium",

    step5Title: "Votre sélection",
    priceHint: "Prix indicatifs TTC au 01/08/2025. Sous réserve de disponibilité et d’éligibilité.",

    step6Title: "Recevoir la documentation par e-mail ou être rappelé",
    fLastName: "Nom*",
    fFirstName: "Prénom*",
    fPhone: "Téléphone*",
    fEmail: "E-mail*",
    optDocs: "Recevoir la documentation complète",
    optFiche: "Fiche technique de la maison",
    optVEFA: "Informations sur le financement VEFA",
    optCall: "Être rappelé par un conseiller",
    optVisit: "Demander une visite du terrain",
    consent: "J’accepte d’être recontacté au sujet de ma demande (RGPD).",
    send: "Envoyer ma demande",

    msgOk: "Merci ! Votre demande a été envoyée. Un conseiller CRAFT vous contactera rapidement.",
    msgFail: "Oups… impossible d’envoyer la demande. Réessayez plus tard ou contactez-nous par téléphone.",
    msgNeed: "Merci de renseigner tous les champs obligatoires (*) et d’accepter la recontactation.",
    msgNet: "Erreur réseau. Vérifiez la connexion et réessayez.",

    // bloc «спасибо»
    thanksTitle: "Merci pour votre demande !",
    thanksLead: "Notre équipe CRAFT vous contactera sous peu.",
    thanksClose: "Merci de votre confiance !<br>Vous pouvez fermer cette page en toute sécurité."
  },
  en: {
    headerTitle: "Le Grand Clos — Select your lot",
    headerHint: "Homes T4 (84 m²), T5 Classic (106 m²), T5 Contemporary (104 m²) — Le Quiou (22630)",

    step0Title: "Would you like to get information about an available lot?",
    intentYes: "Yes, I’m looking for a lot",
    intentNo: "No, just exploring the project",

    step1Title: "Which house type are you interested in?",
    typeT4: "T4 — 84 m²",
    typeT5c: "T5 Classic — 106 m²",
    typeT5cont: "T5 Contemporary — 104 m²",

    step2Title: "Do you want to pick a specific lot?",
    hasLotYes: "Yes, choose a lot",
    hasLotNo: "No preference, suggest one",

    step3Title: "Select your lot",
    reserved: "Reserved",

    step4Title: "Do you prefer the Classic or Premium version?",
    packClassique: "Classic",
    packPremium: "Premium",

    step5Title: "Your selection",
    priceHint: "Indicative TTC prices as of 01/08/2025. Subject to availability and eligibility.",

    step6Title: "Receive documentation by email or request a call back",
    fLastName: "Last name*",
    fFirstName: "First name*",
    fPhone: "Phone*",
    fEmail: "Email*",
    optDocs: "Receive full documentation",
    optFiche: "House technical datasheet",
    optVEFA: "VEFA financing information",
    optCall: "Be called back by an advisor",
    optVisit: "Request a site visit",
    consent: "I agree to be contacted regarding my request (GDPR).",
    send: "Send my request",

    msgOk: "Thanks! Your request has been sent. A CRAFT advisor will contact you shortly.",
    msgFail: "Oops… couldn’t send your request. Please try again later or call us.",
    msgNeed: "Please fill all required fields (*) and accept to be contacted.",
    msgNet: "Network error. Please check your connection and try again.",

    thanksTitle: "Thank you for your request!",
    thanksLead: "Our CRAFT team will contact you shortly.",
    thanksClose: "Thank you for your trust!<br>You can safely close this page."
  }
};

let currentLang = (new URLSearchParams(location.search).get("lang")||"fr").toLowerCase();
function setLangButtons(){
  const fr = document.getElementById("langFR");
  const en = document.getElementById("langEN");
  if(!fr||!en) return;
  if(currentLang==="fr"){ fr.style.opacity=1; en.style.opacity=.7; }
  else { fr.style.opacity=.7; en.style.opacity=1; }
  fr.onclick=()=>{ currentLang="fr"; translateUI(); history.replaceState({}, "", location.pathname+"?lang=fr"); setLangButtons(); };
  en.onclick=()=>{ currentLang="en"; translateUI(); history.replaceState({}, "", location.pathname+"?lang=en"); setLangButtons(); };
}

function setLabelAfterInput(labelEl, text){
  if(!labelEl) return;
  // найдём/создадим span после input, чтобы не ломать слушатели
  let span = labelEl.querySelector("span._t");
  if(!span){
    span = document.createElement("span");
    span.className = "_t";
    span.style.marginLeft = "6px";
    labelEl.appendChild(span);
  }
  span.textContent = " " + text;
}

function translateUI(){
  const T = LANG[currentLang];

  // Заголовок и подзаголовок
  const h1 = document.querySelector("header h1");
  const hint = document.querySelector("header .hint");
  if(h1) h1.textContent = T.headerTitle;
  if(hint) hint.textContent = T.headerHint;

  // Step 0
  const s0 = document.querySelector("#step0 .step-title");
  if(s0) s0.textContent = T.step0Title;
  setLabelAfterInput(document.querySelector('label.choice:has([name="intent"][value="yes"])'), T.intentYes);
  setLabelAfterInput(document.querySelector('label.choice:has([name="intent"][value="no"])'), T.intentNo);

  // Step 1
  const s1 = document.querySelector("#step1 .step-title");
  if(s1) s1.childNodes[0].nodeValue = T.step1Title + " ";
  setLabelAfterInput(document.querySelector('label.choice:has([name="type"][value="T4"])'), T.typeT4);
  setLabelAfterInput(document.querySelector('label.choice:has([name="type"][value="T5_classique"])'), T.typeT5c);
  setLabelAfterInput(document.querySelector('label.choice:has([name="type"][value="T5_contemporain"])'), T.typeT5cont);

  // Step 2
  const s2 = document.querySelector("#step2 .step-title");
  if(s2) s2.textContent = T.step2Title;
  setLabelAfterInput(document.querySelector('label.choice:has([name="hasLot"][value="yes"])'), T.hasLotYes);
  setLabelAfterInput(document.querySelector('label.choice:has([name="hasLot"][value="no"])'), T.hasLotNo);

  // Step 3
  const s3 = document.querySelector("#step3 .step-title");
  if(s3) s3.textContent = T.step3Title;
  // ярлык "Réservé/Reserved" подставим в момент генерации списка лотов (ниже мы используем T.reserved)

  // Step 4
  const s4 = document.querySelector("#step4 .step-title");
  if(s4) s4.textContent = T.step4Title;
  setLabelAfterInput(document.querySelector('label.choice:has([name="pack"][value="classique"])'), T.packClassique);
  setLabelAfterInput(document.querySelector('label.choice:has([name="pack"][value="premium"])'), T.packPremium);

  // Step 5
  const s5 = document.querySelector("#recap .step-title");
  if(s5) s5.textContent = T.step5Title;
  const priceHint = document.querySelector("#recap .hint");
  if(priceHint) priceHint.textContent = T.priceHint;

  // Step 6 — форма
  const s6 = document.querySelector("#contact .step-title");
  if(s6) s6.textContent = T.step6Title;

  // Подписи к полям формы
  const labLast = document.querySelector('input[name="lastName"]')?.closest("label");
  const labFirst = document.querySelector('input[name="firstName"]')?.closest("label");
  const labPhone = document.querySelector('input[name="phone"]')?.closest("label");
  const labEmail = document.querySelector('input[name="email"]')?.closest("label");
  if(labLast) labLast.childNodes[0].nodeValue = T.fLastName;
  if(labFirst) labFirst.childNodes[0].nodeValue = T.fFirstName;
  if(labPhone) labPhone.childNodes[0].nodeValue = T.fPhone;
  if(labEmail) labEmail.childNodes[0].nodeValue = T.fEmail;

  // Чекбоксы-опции
  setLabelAfterInput(document.querySelector('label.choice:has([name="opt_docs"])'), T.optDocs);
  setLabelAfterInput(document.querySelector('label.choice:has([name="opt_fiche"])'), T.optFiche);
  setLabelAfterInput(document.querySelector('label.choice:has([name="opt_vefa"])'), T.optVEFA);
  setLabelAfterInput(document.querySelector('label.choice:has([name="opt_call"])'), T.optCall);
  setLabelAfterInput(document.querySelector('label.choice:has([name="opt_visit"])'), T.optVisit);

  // Consent
  const consentLab = document.querySelector('input[name="consent"]')?.closest("label");
  if(consentLab){
    // оставим чекбокс, заменим текст после
    let span = consentLab.querySelector("span._t");
    if(!span){ span = document.createElement("span"); span.className="_t"; span.style.marginLeft="6px"; consentLab.appendChild(span); }
    span.textContent = " " + T.consent;
  }

  // Кнопка отправки
  const submitBtn = document.querySelector('#leadForm button[type="submit"]');
  if(submitBtn) submitBtn.textContent = T.send;

  // Сохраним строки статуса (используем ниже в обработчике)
  window.__I18N__ = {
    msgOk: T.msgOk, msgFail: T.msgFail, msgNeed: T.msgNeed, msgNet: T.msgNet, reserved: T.reserved,
    thanksTitle: T.thanksTitle, thanksLead: T.thanksLead, thanksClose: T.thanksClose
  };
}

document.addEventListener("DOMContentLoaded", () => {
  translateUI();
  setLangButtons();
});
</script>


<!doctype html>
<html lang="fr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Le Grand Clos – Sélection de lot | CRAFT IMMO</title>
<style>
  :root{
    --brand:#23A3FF; /* bleu CRAFT (можно подправить) */
    --ink:#1c1f24; --muted:#6b7280; --bg:#f7f9fc; --card:#fff; --ok:#10b981; --warn:#f59e0b; --danger:#ef4444;
  }
  *{box-sizing:border-box}
  body{margin:0;font:16px/1.5 system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Arial,sans-serif;color:var(--ink);background:var(--bg)}
  .wrap{max-width:880px;margin:24px auto;padding:0 16px}
  header{display:flex;gap:12px;align-items:center;margin:8px 0 16px}
  .logo{width:28px;height:28px;border-radius:6px;background:var(--brand);display:inline-block}
  h1{font-size:clamp(22px,3.6vw,32px);margin:0}
  .card{background:var(--card);border-radius:14px;box-shadow:0 6px 24px rgba(0,0,0,.06);padding:18px;margin:14px 0}
  .step-title{font-weight:700;margin:0 0 8px}
  fieldset{border:0;padding:0;margin:0}
  .choices{display:grid;gap:10px}
  .choices.grid-3{grid-template-columns:repeat(auto-fit,minmax(180px,1fr))}
  label.choice{border:1.5px solid #e5e7eb;border-radius:12px;padding:12px;cursor:pointer;display:flex;gap:10px;align-items:center;background:#fff;transition:.2s}
  label.choice:hover{border-color:var(--brand)}
  input[type=radio],input[type=checkbox]{accent-color:var(--brand)}
  .hint{color:var(--muted);font-size:14px}
  .hidden{display:none}
  .pill{display:inline-block;padding:4px 10px;border-radius:999px;background:#eef6ff;color:#0b5cab;font-weight:600;font-size:12px}
  .price{font-size:22px;font-weight:800}
  .btn{display:inline-block;padding:12px 16px;border-radius:12px;border:0;background:var(--brand);color:#fff;font-weight:700;cursor:pointer}
  .btn:disabled{opacity:.5;cursor:not-allowed}
  .grid{display:grid;gap:12px}
  .grid.cols-2{grid-template-columns:repeat(auto-fit,minmax(220px,1fr))}
  input[type=text],input[type=tel],input[type=email],select,textarea{
    width:100%;padding:12px;border:1.5px solid #e5e7eb;border-radius:10px;background:#fff;font:inherit
  }
  textarea{min-height:110px;resize:vertical}
  .badge{font-size:12px;padding:2px 8px;border-radius:8px}
  .badge.res{background:#fff3cd;color:#7a5900;border:1px solid #ffe69c}
  .footer-note{font-size:12px;color:var(--muted)}
</style>
</head>
<body>
  <div class="wrap">
    <header>
      <span class="logo" aria-hidden="true"></span>
      <div>
        <h1>Le Grand Clos — Votre sélection de lot</h1>
        <div class="hint">Maisons T4 (84 m²), T5 Classique (106 m²), T5 Contemporain (104 m²) — Le Quiou (22630)</div>
      </div>
    </header>

    <!-- STEP 0: Intention -->
    <section id="step0" class="card">
      <p class="step-title">Souhaitez-vous obtenir des informations sur un lot disponible&nbsp;?</p>
      <fieldset class="choices grid-3" role="radiogroup" aria-label="Intention">
        <label class="choice"><input type="radio" name="intent" value="yes" /> Oui, je cherche un lot</label>
        <label class="choice"><input type="radio" name="intent" value="no" /> Non, juste découvrir le projet</label>
      </fieldset>
      <div class="hint">Sélectionnez « Oui » pour démarrer le configurateur.</div>
    </section>

    <!-- STEP 1: Type de maison -->
    <section id="step1" class="card hidden">
      <p class="step-title">Quel type de maison vous intéresse&nbsp;? <span class="pill">Choix unique</span></p>
      <fieldset class="choices grid-3" role="radiogroup" aria-label="Type de maison">
        <label class="choice"><input type="radio" name="type" value="T4" /> T4 — 84 m²</label>
        <label class="choice"><input type="radio" name="type" value="T5_classique" /> T5 Classique — 106 m²</label>
        <label class="choice"><input type="radio" name="type" value="T5_contemporain" /> T5 Contemporain — 104 m²</label>
      </fieldset>
      <div class="hint">Vous pourrez ensuite préciser le lot.</div>
    </section>

    <!-- STEP 2: Lot précis ? -->
    <section id="step2" class="card hidden">
      <p class="step-title">Souhaitez-vous choisir un lot précis&nbsp;?</p>
      <fieldset class="choices grid-3" role="radiogroup" aria-label="Lot précis">
        <label class="choice"><input type="radio" name="hasLot" value="yes" /> Oui, choisir un lot</label>
        <label class="choice"><input type="radio" name="hasLot" value="no" /> Peu importe, proposez-moi</label>
      </fieldset>
      <div class="hint">Nous affichons jusqu’à 10 premiers lots. Les lots 12–13 sont indiqués en « Réservé ».</div>
    </section>

    <!-- STEP 3: Choix du lot -->
    <section id="step3" class="card hidden">
      <p class="step-title">Sélectionnez votre lot</p>
      <div id="lotList" class="choices"></div>
      <div class="hint">Seuls les lots correspondant au type choisi sont proposés.</div>
    </section>

    <!-- STEP 4: Prestations -->
    <section id="step4" class="card hidden">
      <p class="step-title">Souhaitez-vous la version <strong>Classique</strong> ou <strong>Premium</strong>&nbsp;?</p>
      <fieldset class="choices grid-3" role="radiogroup" aria-label="Prestations">
        <label class="choice"><input type="radio" name="pack" value="classique" /> Classique</label>
        <label class="choice"><input type="radio" name="pack" value="premium" /> Premium</label>
      </fieldset>
      <div class="hint">La différence porte sur les finitions et certains équipements (détails sur demande).</div>
    </section>

    <!-- STEP 5: Récap + Prix -->
    <section id="recap" class="card hidden">
      <p class="step-title">Votre sélection</p>
      <div id="summary"></div>
      <hr style="border:none;border-top:1px solid #eee;margin:12px 0">
      <div id="priceLine" class="price"></div>
      <div class="hint">Prix indicatifs TTC au 01/08/2025. Sous réserve de disponibilité et d’éligibilité.</div>
    </section>

    <!-- STEP 6: Contact -->
    <section id="contact" class="card hidden">
      <p class="step-title">Recevoir la documentation par e-mail ou être rappelé</p>
      <form id="leadForm" class="grid" novalidate>
        <div class="grid cols-2">
          <div><label>Nom*<br><input type="text" name="lastName" required></label></div>
          <div><label>Prénom*<br><input type="text" name="firstName" required></label></div>
        </div>
        <div class="grid cols-2">
          <div><label>Téléphone*<br><input type="tel" name="phone" required></label></div>
          <div><label>E-mail*<br><input type="email" name="email" required></label></div>
        </div>

        <fieldset class="choices">
          <legend class="hint">Options souhaitées (facultatif)</legend>
          <label class="choice"><input type="checkbox" name="opt_docs" /> Recevoir la documentation complète</label>
          <label class="choice"><input type="checkbox" name="opt_fiche" /> Fiche technique de la maison</label>
          <label class="choice"><input type="checkbox" name="opt_vefa" /> Informations sur le financement VEFA</label>
          <label class="choice"><input type="checkbox" name="opt_call" /> Être rappelé par un conseiller</label>
          <label class="choice"><input type="checkbox" name="opt_visit" /> Demander une visite du terrain</label>
        </fieldset>

        <label>Vos précisions (facultatif)<br>
          <textarea name="message" placeholder="Ex. créneau d’appel, remarques…"></textarea>
        </label>

        <label class="hint"><input type="checkbox" name="consent" required /> J’accepte d’être recontacté au sujet de ma demande (RGPD).</label>

        <button class="btn" type="submit">Envoyer ma demande</button>
        <div id="formStatus" class="hint"></div>
        <div class="footer-note">SAS CRAFT — contact@craft.immo — +33 1 88 24 17 76</div>
      </form>
    </section>
  </div>

<script>
/* ===== Données projet =====
   Types & surfaces issues de la présentation et du plan.
   Prix Classique/Premium: grilles du 01/08/2025.
*/
const TYPES = {
  T4: { label: "T4", surface: 84 },
  T5_classique: { label: "T5 Classique", surface: 106 },
  T5_contemporain: { label: "T5 Contemporain", surface: 104 },
};

// Répartition des lots (on affiche 1→10; 12–13 marqués «Réservé»)
const LOTS = [
  { lot:1,  type:"T4",              terrain:398, classique:217400, premium:258000, dispo:true },
  { lot:2,  type:"T5_classique",    terrain:377, classique:246500, premium:293000, dispo:true },
  { lot:3,  type:"T5_classique",    terrain:338, classique:240500, premium:286000, dispo:true },
  { lot:4,  type:"T4",              terrain:438, classique:237400, premium:282500, dispo:true },
  { lot:5,  type:"T5_contemporain", terrain:690, classique:262500, premium:312000, dispo:true },
  { lot:6,  type:"T4",              terrain:524, classique:227400, premium:270500, dispo:true },
  { lot:7,  type:"T4",              terrain:540, classique:227400, premium:270500, dispo:true },
  { lot:8,  type:"T5_contemporain", terrain:730, classique:262500, premium:312000, dispo:true },
  { lot:9,  type:"T5_classique",    terrain:370, classique:246000, premium:292500, dispo:true },
  { lot:10, type:"T5_classique",    terrain:380, classique:246000, premium:292500, dispo:true },
  // Options en réserve (affichées mais désactivées)
  { lot:12, type:"T5_contemporain", terrain:475, classique:262000, premium:311500, dispo:false},
  { lot:13, type:"T5_contemporain", terrain:455, classique:262000, premium:311500, dispo:false},
];

// ===== État du wizard =====
const state = { intent:null, type:null, hasLot:null, lot:null, pack:null };

const $ = (sel) => document.querySelector(sel);
const $$ = (sel) => Array.from(document.querySelectorAll(sel));

function show(id, yes=true){ const el = $("#"+id); el.classList.toggle("hidden", !yes); }

function nextFromIntent(){
  state.intent = document.querySelector('input[name="intent"]:checked')?.value || null;
  show("step1", state.intent==="yes");
  show("step2", false); show("step3", false); show("step4", false); show("recap", false); show("contact", false);
}
function nextFromType(){
  state.type = document.querySelector('input[name="type"]:checked')?.value || null;
  if(!state.type) return;
  show("step2", true); show("step3", false); show("step4", false); show("recap", false); show("contact", false);
}
function nextFromHasLot(){
  state.hasLot = document.querySelector('input[name="hasLot"]:checked')?.value || null;
  if(state.hasLot==="yes"){ renderLots(); show("step3", true); show("step4", false); }
  else { state.lot = null; show("step3", false); show("step4", true); }
}
function renderLots(){
  const wrap = $("#lotList");
  wrap.innerHTML = "";
  const subset = LOTS.filter(l => (l.lot<=10 || !l.dispo) && l.type===state.type);
  subset.forEach(l=>{
    const id = "lot-"+l.lot;
    const disabled = !l.dispo;
    const label = `
      <label class="choice" ${disabled?'style="opacity:.6"':''}>
        <input type="radio" name="lot" value="${l.lot}" ${disabled?'disabled':''}>
        Lot ${l.lot} — ${TYPES[l.type].label} · ${TYPES[l.type].surface} m² · Terrain ${l.terrain} m²
        ${disabled?'<span class="badge res" style="margin-left:auto">Réservé</span>':''}
      </label>`;
    wrap.insertAdjacentHTML("beforeend", label);
  });
}
function nextFromLot(){
  const chosen = document.querySelector('input[name="lot"]:checked');
  state.lot = chosen ? parseInt(chosen.value,10) : null;
  if(state.hasLot==="yes" && !state.lot) return;
  show("step4", true);
}
function nextFromPack(){
  state.pack = document.querySelector('input[name="pack"]:checked')?.value || null;
  if(!state.pack) return;
  buildRecap();
  show("recap", true);
  show("contact", true);
  window.scrollTo({top:document.body.scrollHeight, behavior:"smooth"});
}
function fmtEUR(n){ return n.toLocaleString('fr-FR',{style:'currency',currency:'EUR', maximumFractionDigits:0}); }

function buildRecap(){
  const lotObj = state.lot ? LOTS.find(l=>l.lot===state.lot) :
                 LOTS.filter(l=>l.dispo && l.type===state.type && l.lot<=10)[0]; // proposit° automatique
  const packPrice = state.pack==="premium" ? lotObj.premium : lotObj.classique;
  const packLabel = state.pack==="premium" ? "Premium" : "Classique";

  state._resolvedLot = lotObj; // garder sous la main
  $("#summary").innerHTML = `
    <div><strong>Type :</strong> ${TYPES[lotObj.type].label} (${TYPES[lotObj.type].surface} m²)</div>
    <div><strong>Lot :</strong> ${lotObj.lot} (Terrain ${lotObj.terrain} m²)</div>
    <div><strong>Prestations :</strong> ${packLabel}</div>`;
  $("#priceLine").textContent = `Prix indicatif : ${fmtEUR(packPrice)} TTC`;
}

// Listeners
$$('input[name="intent"]').forEach(i=>i.addEventListener('change', nextFromIntent));
$$('input[name="type"]').forEach(i=>i.addEventListener('change', nextFromType));
$$('input[name="hasLot"]').forEach(i=>i.addEventListener('change', nextFromHasLot));
document.addEventListener('change', (e)=>{
  if(e.target.name==="lot") nextFromLot();
  if(e.target.name==="pack") nextFromPack();
});

// Formulaire (démo sans backend)
$("#leadForm").addEventListener("submit", async (e)=>{
  e.preventDefault();
  const f = new FormData(e.target);
  if(!(f.get("lastName") && f.get("firstName") && f.get("phone") && f.get("email") && f.get("consent"))){
    $("#formStatus").textContent = "Merci de renseigner tous les champs obligatoires (*) et d’accepter la recontactation.";
    $("#formStatus").style.color = "var(--danger)";
    return;
  }
  const sel = state._resolvedLot;
  const payload = {
    lot: sel.lot, type: TYPES[sel.type].label, surface: TYPES[sel.type].surface,
    terrain: sel.terrain, pack: state.pack,
    price: state.pack==="premium" ? sel.premium : sel.classique,
    lastName: f.get("lastName"), firstName: f.get("firstName"),
    phone: f.get("phone"), email: f.get("email"),
    options: {
      docs: !!f.get("opt_docs"), fiche: !!f.get("opt_fiche"),
      vefa: !!f.get("opt_vefa"), call: !!f.get("opt_call"), visit: !!f.get("opt_visit")
    },
    message: f.get("message")||""
  };

 // === Отправка формы через Formspree ===
const endpoint = "https://formspree.io/f/mkgqppvv";

try {
  const resp = await fetch(endpoint, {
    method: "POST",
    headers: { "Content-Type": "application/json", "Accept": "application/json" },
    body: JSON.stringify({
      _subject: `Lead: Le Grand Clos | Lot ${payload.lot} | ${payload.type}`,
      _replyto: payload.email,
      ...payload
    })
  });

  const s = $("#formStatus");
if (resp.ok) {
  // Скрываем форму
  e.target.classList.add("hidden");

  // Показываем финальное сообщение с контактами
  const wrap = document.createElement("div");
  wrap.style.textAlign = "center";
  wrap.style.padding = "60px 20px";
  wrap.style.fontSize = "18px";
  wrap.innerHTML = `
    <h2 style="color:var(--ok);font-size:26px;margin-bottom:20px;">Merci pour votre demande !</h2>
    <p>Notre équipe CRAFT vous contactera sous peu.</p>
    <hr style="margin:30px auto;width:120px;border:0;border-top:2px solid #e5e7eb;">
    <p style="font-size:16px;color:var(--muted);margin-top:30px;">
      <strong>CRAFT IMMO</strong><br>
      <a href="mailto:contact@craft.immo" style="color:var(--brand);text-decoration:none;">contact@craft.immo</a><br>
      📞 +33 1 88 24 17 76
    </p>
    <p style="margin-top:40px;font-size:14px;color:var(--muted);">
      Merci de votre confiance !<br>
      Vous pouvez fermer cette page en toute sécurité.
    </p>
  `;
  s.parentElement.appendChild(wrap);

  // Убираем статусную строку
  s.textContent = "";
} else {
  s.innerHTML = "Oups… impossible d’envoyer la demande. Réessayez plus tard ou contactez-nous par téléphone.";
  s.style.color = "var(--danger)";
}
} catch (err) {
  const s = $("#formStatus");
  s.innerHTML = "Erreur réseau. Vérifiez la connexion et réessayez.";
  s.style.color = "var(--danger)";
}
}); // закрываем addEventListener
</script>
</body>
</html>

