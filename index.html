<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Le Grand Clos ‚Äì S√©lection de lot | CRAFT IMMO</title>
  <style>
    :root{
      --brand:#23A3FF;
      --ink:#1c1f24; --muted:#6b7280; --bg:#f7f9fc; --card:#fff; --ok:#10b981; --warn:#f59e0b; --danger:#ef4444;
    }
    *{box-sizing:border-box}
    body{margin:0;font:16px/1.5 system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Arial,sans-serif;color:var(--ink);background:var(--bg)}
    .wrap{max-width:880px;margin:24px auto;padding:0 16px}
    header{display:flex;gap:12px;align-items:center;margin:8px 0 16px}
    .logo{width:28px;height:28px;border-radius:6px;background:var(--brand);display:inline-block}
    h1{font-size:clamp(22px,3.6vw,32px);margin:0}
    .card{background:var(--card);border-radius:14px;box-shadow:0 6px 24px rgba(0,0,0,.06);padding:18px;margin:14px 0}
    .step-title{font-weight:700;margin:0 0 8px}
    fieldset{border:0;padding:0;margin:0}
    .choices{display:grid;gap:10px}
    .choices.grid-3{grid-template-columns:repeat(auto-fit,minmax(180px,1fr))}
    label.choice{border:1.5px solid #e5e7eb;border-radius:12px;padding:12px;cursor:pointer;display:flex;gap:10px;align-items:center;background:#fff;transition:.2s}
    label.choice:hover{border-color:var(--brand)}
    input[type=radio],input[type=checkbox]{accent-color:var(--brand)}
    .hint{color:var(--muted);font-size:14px}
    .hidden{display:none}
    .pill{display:inline-block;padding:4px 10px;border-radius:999px;background:#eef6ff;color:#0b5cab;font-weight:600;font-size:12px}
    .price{font-size:22px;font-weight:800}
    .btn{display:inline-block;padding:12px 16px;border-radius:12px;border:0;background:var(--brand);color:#fff;font-weight:700;cursor:pointer}
    .btn:disabled{opacity:.5;cursor:not-allowed}
    .grid{display:grid;gap:12px}
    .grid.cols-2{grid-template-columns:repeat(auto-fit,minmax(220px,1fr))}
    input[type=text],input[type=tel],input[type=email],select,textarea{
      width:100%;padding:12px;border:1.5px solid #e5e7eb;border-radius:10px;background:#fff;font:inherit
    }
    textarea{min-height:110px;resize:vertical}
    .badge{font-size:12px;padding:2px 8px;border-radius:8px}
    .badge.res{background:#fff3cd;color:#7a5900;border:1px solid #ffe69c}
    .footer-note{font-size:12px;color:var(--muted)}
    #langBar .btn{opacity:.6;background:#eaeef5;color:#111}
    #langBar .btn.active{opacity:1;background:#111;color:#fff}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card" id="langBar" style="display:flex;gap:8px;align-items:center;justify-content:flex-end">
      <button class="btn" id="langFR" type="button">FR</button>
      <button class="btn" id="langEN" type="button">EN</button>
    </div>

    <header>
      <span class="logo" aria-hidden="true"></span>
      <div>
        <h1>Le Grand Clos ‚Äî Votre s√©lection de lot</h1>
        <div class="hint">Maisons T4 (84 m¬≤), T5 Classique (106 m¬≤), T5 Contemporain (104 m¬≤) ‚Äî Le Quiou (22630)</div>
      </div>
    </header>

    <section id="step0" class="card">
      <p class="step-title">Souhaitez-vous obtenir des informations sur un lot disponible&nbsp;?</p>
      <fieldset class="choices grid-3" role="radiogroup" aria-label="Intention">
        <label class="choice"><input type="radio" name="intent" value="yes" /> Oui, je cherche un lot</label>
        <label class="choice"><input type="radio" name="intent" value="no" /> Non, juste d√©couvrir le projet</label>
      </fieldset>
      <div class="hint">S√©lectionnez ¬´ Oui ¬ª pour d√©marrer le configurateur.</div>
    </section>

    <section id="step1" class="card hidden">
      <p class="step-title">Quel type de maison vous int√©resse&nbsp;? <span class="pill">Choix unique</span></p>
      <fieldset class="choices grid-3" role="radiogroup" aria-label="Type de maison">
        <label class="choice"><input type="radio" name="type" value="T4" /> T4 ‚Äî 84 m¬≤</label>
        <label class="choice"><input type="radio" name="type" value="T5_classique" /> T5 Classique ‚Äî 106 m¬≤</label>
        <label class="choice"><input type="radio" name="type" value="T5_contemporain" /> T5 Contemporain ‚Äî 104 m¬≤</label>
      </fieldset>
      <div class="hint">Vous pourrez ensuite pr√©ciser le lot.</div>
    </section>

    <section id="step2" class="card hidden">
      <p class="step-title">Souhaitez-vous choisir un lot pr√©cis&nbsp;?</p>
      <fieldset class="choices grid-3" role="radiogroup" aria-label="Lot pr√©cis">
        <label class="choice"><input type="radio" name="hasLot" value="yes" /> Oui, choisir un lot</label>
        <label class="choice"><input type="radio" name="hasLot" value="no" /> Peu importe, proposez-moi</label>
      </fieldset>
      <div class="hint">Nous affichons jusqu‚Äô√† 10 premiers lots. Les lots 12‚Äì13 sont indiqu√©s en ¬´ R√©serv√© ¬ª.</div>
    </section>

    <section id="step3" class="card hidden">
      <p class="step-title">S√©lectionnez votre lot</p>
      <div id="lotList" class="choices"></div>
      <div class="hint">Seuls les lots correspondant au type choisi sont propos√©s.</div>
    </section>

    <section id="step4" class="card hidden">
      <p class="step-title">Souhaitez-vous la version <strong>Classique</strong> ou <strong>Premium</strong>&nbsp;?</p>
      <fieldset class="choices grid-3" role="radiogroup" aria-label="Prestations">
        <label class="choice"><input type="radio" name="pack" value="classique" /> Classique</label>
        <label class="choice"><input type="radio" name="pack" value="premium" /> Premium</label>
      </fieldset>
      <div class="hint">La diff√©rence porte sur les finitions et certains √©quipements (d√©tails sur demande).</div>
    </section>

    <section id="recap" class="card hidden">
      <p class="step-title">Votre s√©lection</p>
      <div id="summary"></div>
      <hr style="border:none;border-top:1px solid #eee;margin:12px 0">
      <div id="priceLine" class="price"></div>
      <div class="hint">Prix indicatifs TTC au 01/08/2025. Sous r√©serve de disponibilit√© et d‚Äô√©ligibilit√©.</div>
    </section>

    <section id="contact" class="card hidden">
      <p class="step-title">Recevoir la documentation par e-mail ou √™tre rappel√©</p>
      <form id="leadForm" class="grid" novalidate>
        <div class="grid cols-2">
          <div><label>Nom*<br><input type="text" name="lastName" required></label></div>
          <div><label>Pr√©nom*<br><input type="text" name="firstName" required></label></div>
        </div>
        <div class="grid cols-2">
          <div><label>T√©l√©phone*<br><input type="tel" name="phone" required></label></div>
          <div><label>E-mail*<br><input type="email" name="email" required></label></div>
        </div>

        <fieldset class="choices">
          <legend class="hint">Options souhait√©es (facultatif)</legend>
          <label class="choice"><input type="checkbox" name="opt_docs" /> Recevoir la documentation compl√®te</label>
          <label class="choice"><input type="checkbox" name="opt_fiche" /> Fiche technique de la maison</label>
          <label class="choice"><input type="checkbox" name="opt_vefa" /> Informations sur le financement VEFA</label>
          <label class="choice"><input type="checkbox" name="opt_call" /> √ätre rappel√© par un conseiller</label>
          <label class="choice"><input type="checkbox" name="opt_visit" /> Demander une visite du terrain</label>
        </fieldset>

        <label>Vos pr√©cisions (facultatif)<br>
          <textarea name="message" placeholder="Ex. cr√©neau d‚Äôappel, remarques‚Ä¶"></textarea>
        </label>

        <label class="hint"><input type="checkbox" name="consent" required /> J‚Äôaccepte d‚Äô√™tre recontact√© au sujet de ma demande (RGPD).</label>

        <button class="btn" type="submit">Envoyer ma demande</button>
        <div id="formStatus" class="hint"></div>
        <div class="footer-note">SAS CRAFT ‚Äî contact@craft.immo ‚Äî +33 1 88 24 17 76</div>
      </form>
    </section>
  </div>

  <!-- I18N + –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å —è–∑—ã–∫–æ–≤ (ES5) -->
  <script>
  (function(){
    // --- —Å–ª–æ–≤–∞—Ä—å ---
    var LANG = {
      fr: {
        headerTitle: "Le Grand Clos ‚Äî Votre s√©lection de lot",
        headerHint: "Maisons T4 (84 m¬≤), T5 Classique (106 m¬≤), T5 Contemporain (104 m¬≤) ‚Äî Le Quiou (22630)",
        step0Title: "Souhaitez-vous obtenir des informations sur un lot disponible ?",
        intentYes: "Oui, je cherche un lot",
        intentNo: "Non, juste d√©couvrir le projet",
        step1Title: "Quel type de maison vous int√©resse ?",
        typeT4: "T4 ‚Äî 84 m¬≤",
        typeT5c: "T5 Classique ‚Äî 106 m¬≤",
        typeT5cont: "T5 Contemporain ‚Äî 104 m¬≤",
        step2Title: "Souhaitez-vous choisir un lot pr√©cis ?",
        hasLotYes: "Oui, choisir un lot",
        hasLotNo: "Peu importe, proposez-moi",
        step3Title: "S√©lectionnez votre lot",
        reserved: "R√©serv√©",
        step4Title: "Souhaitez-vous la version Classique ou Premium ?",
        packClassique: "Classique",
        packPremium: "Premium",
        step5Title: "Votre s√©lection",
        priceHint: "Prix indicatifs TTC au 01/08/2025. Sous r√©serve de disponibilit√© et d‚Äô√©ligibilit√©.",
        step6Title: "Recevoir la documentation par e-mail ou √™tre rappel√©",
        fLastName: "Nom*",
        fFirstName: "Pr√©nom*",
        fPhone: "T√©l√©phone*",
        fEmail: "E-mail*",
        optDocs: "Recevoir la documentation compl√®te",
        optFiche: "Fiche technique de la maison",
        optVEFA: "Informations sur le financement VEFA",
        optCall: "√ätre rappel√© par un conseiller",
        optVisit: "Demander une visite du terrain",
        consent: "J‚Äôaccepte d‚Äô√™tre recontact√© au sujet de ma demande (RGPD).",
        send: "Envoyer ma demande",
        msgOk: "Merci ! Votre demande a √©t√© envoy√©e. Un conseiller CRAFT vous contactera rapidement.",
        msgFail: "Oups‚Ä¶ impossible d‚Äôenvoyer la demande. R√©essayez plus tard ou contactez-nous par t√©l√©phone.",
        msgNeed: "Merci de renseigner tous les champs obligatoires (*) et d‚Äôaccepter la recontactation.",
        msgNet: "Erreur r√©seau. V√©rifiez la connexion et r√©essayez.",
        thanksTitle: "Merci pour votre demande !",
        thanksLead: "Notre √©quipe CRAFT vous contactera sous peu.",
        thanksClose: "Merci de votre confiance !<br>Vous pouvez fermer cette page en toute s√©curit√©."
      },
      en: {
        headerTitle: "Le Grand Clos ‚Äî Select your lot",
        headerHint: "Homes T4 (84 m¬≤), T5 Classic (106 m¬≤), T5 Contemporary (104 m¬≤) ‚Äî Le Quiou (22630)",
        step0Title: "Would you like to get information about an available lot?",
        intentYes: "Yes, I‚Äôm looking for a lot",
        intentNo: "No, just exploring the project",
        step1Title: "Which house type are you interested in?",
        typeT4: "T4 ‚Äî 84 m¬≤",
        typeT5c: "T5 Classic ‚Äî 106 m¬≤",
        typeT5cont: "T5 Contemporary ‚Äî 104 m¬≤",
        step2Title: "Do you want to pick a specific lot?",
        hasLotYes: "Yes, choose a lot",
        hasLotNo: "No preference, suggest one",
        step3Title: "Select your lot",
        reserved: "Reserved",
        step4Title: "Do you prefer the Classic or Premium version?",
        packClassique: "Classic",
        packPremium: "Premium",
        step5Title: "Your selection",
        priceHint: "Indicative TTC prices as of 01/08/2025. Subject to availability and eligibility.",
        step6Title: "Receive documentation by email or request a call back",
        fLastName: "Last name*",
        fFirstName: "First name*",
        fPhone: "Phone*",
        fEmail: "Email*",
        optDocs: "Receive full documentation",
        optFiche: "House technical datasheet",
        optVEFA: "VEFA financing information",
        optCall: "Be called back by an advisor",
        optVisit: "Request a site visit",
        consent: "I agree to be contacted regarding my request (GDPR).",
        send: "Send my request",
        msgOk: "Thanks! Your request has been sent. A CRAFT advisor will contact you shortly.",
        msgFail: "Oops‚Ä¶ couldn‚Äôt send your request. Please try again later or call us.",
        msgNeed: "Please fill all required fields (*) and accept to be contacted.",
        msgNet: "Network error. Please check your connection and try again.",
        thanksTitle: "Thank you for your request!",
        thanksLead: "Our CRAFT team will contact you shortly.",
        thanksClose: "Thank you for your trust!<br>You can safely close this page."
      }
    };

    var STORAGE_KEY = "craft-immo-lang";

    function qs(sel){ return document.querySelector(sel); }

    function setLabelAfterInput(labelEl, text){
      if(!labelEl) return;
      var inp = labelEl.querySelector('input');
      if(!inp) return;
      var nodes = Array.prototype.slice.call(labelEl.childNodes);
      for(var i=0;i<nodes.length;i++){
        var n = nodes[i];
        if(n === inp) continue;
        if(n.nodeType === 1 && n.classList && n.classList.contains('_t')) continue;
        labelEl.removeChild(n);
      }
      var span = labelEl.querySelector('span._t');
      if(!span){
        span = document.createElement('span');
        span.className = '_t';
        span.style.marginLeft = '6px';
        labelEl.appendChild(span);
      }
      span.textContent = ' ' + text;
    }

    function getParam(name){
      var m = new RegExp('[?&]'+name+'=([^&]*)').exec(location.search);
      return m ? decodeURIComponent(m[1].replace(/\+/g,' ')) : '';
    }

    function getInitialLang(){
      var urlLang = (getParam('lang')||'').toLowerCase();
      if(urlLang && LANG[urlLang]) return urlLang;
      var saved = null;
      try { saved = localStorage.getItem(STORAGE_KEY); } catch(e){}
      if(saved && LANG[saved]) return saved;
      var nav = (navigator.language||'fr').toLowerCase();
      if(nav.indexOf('fr')===0) return 'fr';
      return 'en';
    }

    var currentLang = getInitialLang();

    function translateUI(){
      var T = LANG[currentLang];

      var h1 = document.querySelector("header h1");
      var hint = document.querySelector("header .hint");
      if(h1) h1.textContent = T.headerTitle;
      if(hint) hint.textContent = T.headerHint;

      var s0 = document.querySelector("#step0 .step-title");
      if(s0) s0.textContent = T.step0Title;
      setLabelAfterInput(document.querySelector('input[name="intent"][value="yes"]') && document.querySelector('input[name="intent"][value="yes"]').closest('label'), T.intentYes);
      setLabelAfterInput(document.querySelector('input[name="intent"][value="no"]')  && document.querySelector('input[name="intent"][value="no"]').closest('label'),  T.intentNo);

      var s1 = document.querySelector("#step1 .step-title");
      if(s1 && s1.firstChild) s1.firstChild.nodeValue = T.step1Title + " ";
      setLabelAfterInput(document.querySelector('input[name="type"][value="T4"]')               && document.querySelector('input[name="type"][value="T4"]').closest('label'),               T.typeT4);
      setLabelAfterInput(document.querySelector('input[name="type"][value="T5_classique"]')    && document.querySelector('input[name="type"][value="T5_classique"]').closest('label'),    T.typeT5c);
      setLabelAfterInput(document.querySelector('input[name="type"][value="T5_contemporain"]') && document.querySelector('input[name="type"][value="T5_contemporain"]').closest('label'), T.typeT5cont);

      var s2 = document.querySelector("#step2 .step-title");
      if(s2) s2.textContent = T.step2Title;
      setLabelAfterInput(document.querySelector('input[name="hasLot"][value="yes"]') && document.querySelector('input[name="hasLot"][value="yes"]').closest('label'), T.hasLotYes);
      setLabelAfterInput(document.querySelector('input[name="hasLot"][value="no"]')  && document.querySelector('input[name="hasLot"][value="no"]').closest('label'),  T.hasLotNo);

      var s3 = document.querySelector("#step3 .step-title");
      if(s3) s3.textContent = T.step3Title;

      var s4 = document.querySelector("#step4 .step-title");
      if(s4) s4.textContent = T.step4Title;
      setLabelAfterInput(document.querySelector('input[name="pack"][value="classique"]') && document.querySelector('input[name="pack"][value="classique"]').closest('label'), T.packClassique);
      setLabelAfterInput(document.querySelector('input[name="pack"][value="premium"]')   && document.querySelector('input[name="pack"][value="premium"]').closest('label'),  T.packPremium);

      var s5 = document.querySelector("#recap .step-title");
      if(s5) s5.textContent = T.step5Title;
      var priceHint = document.querySelector("#recap .hint");
      if(priceHint) priceHint.textContent = T.priceHint;

      var s6 = document.querySelector("#contact .step-title");
      if(s6) s6.textContent = T.step6Title;

      var labLast  = document.querySelector('input[name="lastName"]');
      var labFirst = document.querySelector('input[name="firstName"]');
      var labPhone = document.querySelector('input[name="phone"]');
      var labEmail = document.querySelector('input[name="email"]');
      if(labLast && labLast.closest)  labLast.closest("label").childNodes[0].nodeValue  = T.fLastName;
      if(labFirst && labFirst.closest) labFirst.closest("label").childNodes[0].nodeValue = T.fFirstName;
      if(labPhone && labPhone.closest) labPhone.closest("label").childNodes[0].nodeValue = T.fPhone;
      if(labEmail && labEmail.closest) labEmail.closest("label").childNodes[0].nodeValue = T.fEmail;

      setLabelAfterInput(document.querySelector('input[name="opt_docs"]')  && document.querySelector('input[name="opt_docs"]').closest('label'),  T.optDocs);
      setLabelAfterInput(document.querySelector('input[name="opt_fiche"]') && document.querySelector('input[name="opt_fiche"]').closest('label'), T.optFiche);
      setLabelAfterInput(document.querySelector('input[name="opt_vefa"]')  && document.querySelector('input[name="opt_vefa"]').closest('label'),  T.optVEFA);
      setLabelAfterInput(document.querySelector('input[name="opt_call"]')  && document.querySelector('input[name="opt_call"]').closest('label'),  T.optCall);
      setLabelAfterInput(document.querySelector('input[name="opt_visit"]') && document.querySelector('input[name="opt_visit"]').closest('label'), T.optVisit);

      var consent = document.querySelector('input[name="consent"]');
      if(consent && consent.closest) setLabelAfterInput(consent.closest("label"), T.consent);

      var submitBtn = document.querySelector('#leadForm button[type="submit"]');
      if(submitBtn) submitBtn.textContent = T.send;

      window.__I18N__ = {
        msgOk: T.msgOk, msgFail: T.msgFail, msgNeed: T.msgNeed, msgNet: T.msgNet,
        reserved: T.reserved, thanksTitle: T.thanksTitle, thanksLead: T.thanksLead, thanksClose: T.thanksClose
      };

      var fr = document.getElementById("langFR");
      var en = document.getElementById("langEN");
      if(fr && en){
        if(currentLang==='fr'){ fr.classList.add('active'); en.classList.remove('active'); }
        else{ en.classList.add('active'); fr.classList.remove('active'); }
      }
    }

    function setQueryParam(name, value){
      var q = location.search ? location.search.substr(1).split('&') : [];
      var found = false;
      for(var i=0;i<q.length;i++){
        if(q[i].split('=')[0]===name){ q[i]=name+'='+encodeURIComponent(value); found=true; break; }
      }
      if(!found) q.push(name+'='+encodeURIComponent(value));
      var newUrl = location.pathname + (q.length ? '?'+q.join('&') : '') + location.hash;
      history.replaceState({}, '', newUrl);
    }

    function setLang(lang){
      if(!LANG[lang]) return;
      currentLang = lang;
      try { localStorage.setItem(STORAGE_KEY, lang); } catch(e){}
      setQueryParam('lang', lang);
      translateUI();
    }

    function bindLangButtons(){
      var fr = document.getElementById("langFR");
      var en = document.getElementById("langEN");
      if(fr) fr.addEventListener("click", function(){ setLang('fr'); });
      if(en) en.addEventListener("click", function(){ setLang('en'); });
    }

    document.addEventListener("DOMContentLoaded", function(){
      bindLangButtons();
      translateUI();
    });

    window.setLang = setLang; // –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ
  })();
  </script>

  <!-- –õ–æ–≥–∏–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞ (ES5) -->
  <script>
  var TYPES = {
    T4: { label: "T4", surface: 84 },
    T5_classique: { label: "T5 Classique", surface: 106 },
    T5_contemporain: { label: "T5 Contemporain", surface: 104 }
  };

  var LOTS = [
    { lot:1,  type:"T4",              terrain:398, classique:217400, premium:258000, dispo:true },
    { lot:2,  type:"T5_classique",    terrain:377, classique:246500, premium:293000, dispo:true },
    { lot:3,  type:"T5_classique",    terrain:338, classique:240500, premium:286000, dispo:true },
    { lot:4,  type:"T4",              terrain:438, classique:237400, premium:282500, dispo:true },
    { lot:5,  type:"T5_contemporain", terrain:690, classique:262500, premium:312000, dispo:true },
    { lot:6,  type:"T4",              terrain:524, classique:227400, premium:270500, dispo:true },
    { lot:7,  type:"T4",              terrain:540, classique:227400, premium:270500, dispo:true },
    { lot:8,  type:"T5_contemporain", terrain:730, classique:262500, premium:312000, dispo:true },
    { lot:9,  type:"T5_classique",    terrain:370, classique:246000, premium:292500, dispo:true },
    { lot:10, type:"T5_classique",    terrain:380, classique:246000, premium:292500, dispo:true },
    { lot:12, type:"T5_contemporain", terrain:475, classique:262000, premium:311500, dispo:false},
    { lot:13, type:"T5_contemporain", terrain:455, classique:262000, premium:311500, dispo:false}
  ];

  var state = { intent:null, type:null, hasLot:null, lot:null, pack:null };

  function $(sel){ return document.querySelector(sel); }
  function $all(sel){ return Array.prototype.slice.call(document.querySelectorAll(sel)); }

  function show(id, yes){ var el=$("#"+id); if(!el) return; if(typeof yes==="undefined") yes=true; el.classList.toggle("hidden", !yes); }

  function nextFromIntent(){
    var c = document.querySelector('input[name="intent"]:checked');
    state.intent = c ? c.value : null;
    show("step1", state.intent==="yes");
    show("step2", false); show("step3", false); show("step4", false); show("recap", false); show("contact", false);
  }
  function nextFromType(){
    var c = document.querySelector('input[name="type"]:checked');
    state.type = c ? c.value : null;
    if(!state.type) return;
    show("step2", true); show("step3", false); show("step4", false); show("recap", false); show("contact", false);
  }
  function nextFromHasLot(){
    var c = document.querySelector('input[name="hasLot"]:checked');
    state.hasLot = c ? c.value : null;
    if(state.hasLot==="yes"){ renderLots(); show("step3", true); show("step4", false); }
    else { state.lot = null; show("step3", false); show("step4", true); }
  }
  function renderLots(){
    var wrap = $("#lotList");
    if(!wrap) return;
    wrap.innerHTML = "";
    var subset = LOTS.filter(function(l){ return (l.lot<=10 || !l.dispo) && l.type===state.type; });
    subset.forEach(function(l){
      var disabled = !l.dispo;
      var html = ''
        + '<label class="choice"'+(disabled?' style="opacity:.6"':'')+'>'
        + '  <input type="radio" name="lot" value="'+l.lot+'"'+(disabled?' disabled':'')+'>'
        + '  Lot '+l.lot+' ‚Äî '+TYPES[l.type].label+' ¬∑ '+TYPES[l.type].surface+' m¬≤ ¬∑ Terrain '+l.terrain+' m¬≤'
        + (disabled ? '  <span class="badge res" style="margin-left:auto">'+(window.__I18N__&&window.__I18N__.reserved?window.__I18N__.reserved:'R√©serv√©')+'</span>' : '')
        + '</label>';
      wrap.insertAdjacentHTML("beforeend", html);
    });
  }
  function nextFromLot(){
    var chosen = document.querySelector('input[name="lot"]:checked');
    state.lot = chosen ? parseInt(chosen.value,10) : null;
    if(state.hasLot==="yes" && !state.lot) return;
    show("step4", true);
  }
  function nextFromPack(){
    var c = document.querySelector('input[name="pack"]:checked');
    state.pack = c ? c.value : null;
    if(!state.pack) return;
    buildRecap();
    show("recap", true);
    show("contact", true);
    window.scrollTo(0, document.body.scrollHeight);
  }
  function fmtEUR(n){ try{ return n.toLocaleString('fr-FR',{style:'currency',currency:'EUR', maximumFractionDigits:0}); }catch(e){ return n+' ‚Ç¨'; } }

  function buildRecap(){
    var lotObj = state.lot ? LOTS.filter(function(l){return l.lot===state.lot;})[0]
                           : LOTS.filter(function(l){return l.dispo && l.type===state.type && l.lot<=10;})[0];
    if(!lotObj) return;
    var packPrice = state.pack==="premium" ? lotObj.premium : lotObj.classique;
    var packLabel = state.pack==="premium" ? "Premium" : "Classique";
    state._resolvedLot = lotObj;
    $("#summary").innerHTML = ''
      + '<div><strong>Type :</strong> '+TYPES[lotObj.type].label+' ('+TYPES[lotObj.type].surface+' m¬≤)</div>'
      + '<div><strong>Lot :</strong> '+lotObj.lot+' (Terrain '+lotObj.terrain+' m¬≤)</div>'
      + '<div><strong>Prestations :</strong> '+packLabel+'</div>';
    $("#priceLine").textContent = 'Prix indicatif : '+fmtEUR(packPrice)+' TTC';
  }

  $all('input[name="intent"]').forEach(function(i){ i.addEventListener('change', nextFromIntent); });
  $all('input[name="type"]').forEach(function(i){ i.addEventListener('change', nextFromType); });
  $all('input[name="hasLot"]').forEach(function(i){ i.addEventListener('change', nextFromHasLot); });
  document.addEventListener('change', function(e){
    if(e.target && e.target.name==="lot") nextFromLot();
    if(e.target && e.target.name==="pack") nextFromPack();
  });

  var leadForm = $("#leadForm");
  if(leadForm){
    leadForm.addEventListener("submit", function(e){
      e.preventDefault();
      var s = $("#formStatus");
      var f = new FormData(leadForm);

      if(!(f.get("lastName") && f.get("firstName") && f.get("phone") && f.get("email") && f.get("consent"))){
        s.textContent = (window.__I18N__ && window.__I18N__.msgNeed) ? window.__I18N__.msgNeed : "Merci de renseigner tous les champs obligatoires (*) et d‚Äôaccepter la recontactation.";
        s.style.color = "var(--danger)"; return;
      }
      var sel = state._resolvedLot;
      if(!sel){ s.textContent = "S√©lection incompl√®te."; s.style.color="var(--danger)"; return; }

      var payload = {
        lot: sel.lot, type: TYPES[sel.type].label, surface: TYPES[sel.type].surface,
        terrain: sel.terrain, pack: state.pack,
        price: state.pack==="premium" ? sel.premium : sel.classique,
        lastName: f.get("lastName"), firstName: f.get("firstName"),
        phone: f.get("phone"), email: f.get("email"),
        options: {
          docs: !!f.get("opt_docs"), fiche: !!f.get("opt_fiche"),
          vefa: !!f.get("opt_vefa"), call: !!f.get("opt_call"), visit: !!f.get("opt_visit")
        },
        message: f.get("message")||""
      };

      var endpoint = "https://formspree.io/f/mkgqppvv";

      fetch(endpoint, {
        method: "POST",
        headers: { "Content-Type": "application/json", "Accept": "application/json" },
        body: JSON.stringify({
          _subject: "Lead: Le Grand Clos | Lot "+payload.lot+" | "+payload.type,
          _replyto: payload.email,
          lot: payload.lot, type: payload.type, surface: payload.surface,
          terrain: payload.terrain, pack: payload.pack, price: payload.price,
          lastName: payload.lastName, firstName: payload.firstName,
          phone: payload.phone, email: payload.email,
          options: payload.options, message: payload.message
        })
      }).then(function(resp){
        if(resp.ok){
          leadForm.classList.add("hidden");
          var wrap = document.createElement("div");
          wrap.style.textAlign = "center";
          wrap.style.padding = "60px 20px";
          wrap.style.fontSize = "18px";
          wrap.innerHTML = ''
            + '<h2 style="color:var(--ok);font-size:26px;margin-bottom:20px;">'+((window.__I18N__&&window.__I18N__.thanksTitle)||'Merci pour votre demande !')+'</h2>'
            + '<p>'+((window.__I18N__&&window.__I18N__.thanksLead)||'Notre √©quipe CRAFT vous contactera sous peu.')+'</p>'
            + '<hr style="margin:30px auto;width:120px;border:0;border-top:2px solid #e5e7eb;">'
            + '<p style="font-size:16px;color:var(--muted);margin-top:30px;"><strong>CRAFT IMMO</strong><br>'
            + '<a href="mailto:contact@craft.immo" style="color:var(--brand);text-decoration:none;">contact@craft.immo</a><br>üìû +33 1 88 24 17 76</p>'
            + '<p style="margin-top:40px;font-size:14px;color:var(--muted);">'+((window.__I18N__&&window.__I18N__.thanksClose)||'Merci de votre confiance !<br>Vous pouvez fermer cette page en toute s√©curit√©.')+'</p>';
          s.parentElement.appendChild(wrap);
          s.textContent = "";
        } else {
          s.innerHTML = (window.__I18N__&&window.__I18N__.msgFail) ? window.__I18N__.msgFail : "Oups‚Ä¶ impossible d‚Äôenvoyer la demande. R√©essayez plus tard ou contactez-nous par t√©l√©phone.";
          s.style.color = "var(--danger)";
        }
      }).catch(function(){
        s.innerHTML = (window.__I18N__&&window.__I18N__.msgNet) ? window.__I18N__.msgNet : "Erreur r√©seau. V√©rifiez la connexion et r√©essayez.";
        s.style.color = "var(--danger)";
      });
    });
  }
  </script>
</body>
</html>
